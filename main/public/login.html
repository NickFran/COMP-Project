<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Login</title>
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <header>
        <nav class="navBar" role="navigation" aria-label="Main Navigation">
            <div class="LogoNTitle">
                <a href="./index.html" class="Title">XYZ Company</a>
            </div>

            <div class="RightControls">
                <div class="Navigation" id="mainNav" aria-hidden="false">
                    <a href="./about.html" class="nav-item About" aria-label="About">About</a>
                    <a href="./contact.html" class="nav-item Contact" aria-label="Contact">Contact</a>

                    <!-- Desktop-only signup (now an image) -->
                    <a href="./login.html" class="nav-item Profile ProfileDesktop" aria-label="Log In">
                        <img src="./Media/add-userDetail.png" alt="Signup" class="ProfileLogo profile-img">
                    </a>

                    <!-- Resources -->
                    <div class="Resources" id="resourcesBtn" aria-haspopup="true">
                        <button id="resourcesToggle" class="resources-toggle" aria-expanded="false" aria-label="Open the additional resources menu" aria-controls="resourcesDropdown">
                            Resources ▾
                        </button>
                        <div id="resourcesDropdown" class="resources-dropdown" role="menu" aria-hidden="true">
                            <a href="../private/doc.html" class="dropdown-item" aria-label="Documentation">Documentation</a>
                            <a href="../private/secpol.html" class="dropdown-item" aria-label="Security Policy">Security Policy</a>
                            <a href="./legal.html" class="dropdown-item" aria-label="Legal">Legal</a>
                            <a href="../restricted/endpoints.html" class="dropdown-item" aria-label="Endpoints">Endpoints</a>
                        </div>
                    </div>
                </div>

                <!-- Mobile-only signup which appears to the left of the hamburger on small screens -->
                <a href="./login.html" class="nav-item Profile ProfileMobile" id="signupMobile" aria-label="log in">
                    <img src="./Media/add-userDetail.png" alt="Signup" class="ProfileLogo profile-img">
                </a>

                <button class="MobileMenu" id="mobileToggle" aria-controls="mainNav" aria-expanded="false" aria-label="Open the menu">☰</button>
            </div>
        </nav>
    </header>

    <main>
        <section class="HeroSection">
            <div class="spacer1"></div>
            <article>
                <div class="heading center underborder width2">Log In</div>
                <div class="card center wide1">
                    <form id="login-form" class="registration-form" novalidate>
                        <div class="form-row">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" id="email" name="email" class="form-input" placeholder="you@example.com" required aria-required="true">
                        </div>

                        <div class="form-row">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" id="password" name="password" class="form-input" placeholder="At least 12 characters" required aria-required="true">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn primary">Login</button>
                        </div>
                        
                    </form>
                    <div>Don't have an account? <a href="register.html">Create one</a></div>
                </div>
            </article>
        </section>
    </main>

                <!-- login client script -->
        <script>
            async function handleLogin(e) {
                e.preventDefault();
                const data = Object.fromEntries(new FormData(e.target));
                const email = (data.email || '').trim();
                const password = data.password || '';
                if (!email || !password) return alert('Enter email and password');
                try {
                    const base = window.location.origin;
                    const res = await fetch(base + '/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });
                    const body = await res.json().catch(() => null);
                    console.log('login response', res.status, body);
                    if (!res.ok) throw new Error((body && body.error) || 'Login failed');
                    // success — redirect or show message
                    alert('Login successful');
                    window.location.href = '/index.html';
                } catch (err) {
                    console.error('Login error', err);
                    alert('Error: ' + err.message + '\nSee console for details');
                }
            }

            document.addEventListener('DOMContentLoaded', () => {
                const f = document.getElementById('login-form');
                if (f) f.addEventListener('submit', handleLogin);
            });
        </script>
        <!-- load navigation logic from external file -->
        <script src="./main.js" defer></script>
</body>
</html>